"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>{let t,s;return function(...r){return s||(t=e(...r),s=!0),t}},t=e=>{if(!e)return!0;if(Array.isArray(e)){if(0===e.length)return!0}else if("object"==typeof e&&0===Object.keys(e).length)return!0;return!1},s=e=>e[0],r=(e,i)=>({brackets:[],mentions:[],ignoreInsideQuotes:!0,includeSeparatorMode:"NONE",ignoreCase:!0,trimResult:!0,trimSeparators:!1,check:void 0,defaultBrackets:[["(",")"],["[","]"],["{","}"]],...i,separators:e,init(){if(Array.isArray(this.mentions)||"string"==typeof this.mentions){const e=[this.mentions].flat().filter(Boolean).reduce(((e,t)=>(e[this.ignoreCase?t.toUpperCase():t]=t,e)),{});this.mentions=!t(e)&&e}return this.createBracketsMap().createBracketsSearch().createSeparatorsSearch()},merge(e){return e?(e={...this,...e},["brackets","mentions"].some((t=>t in e))&&e.init(),e):this},arrayToPattern(e){var t;const s=null!=(t=r.screenedSymbols)?t:r.screenedSymbols=new Set(".{}[]^()+*?\\/$|".split(""));return e.map((e=>e.split("").map((e=>s.has(e)?"\\"+e:e)).join(""))).join("|")},createRegExp:e=>RegExp(e,"g"),createBracketsMap(){let{brackets:e=[],ignoreInsideQuotes:t}=this;return!0===e?e=this.defaultBrackets:"object"!=typeof e||Array.isArray(e)?"string"==typeof e&&(e=e.split(",").map((e=>{let t=e.trim().split(" ");if(2!==t.length){if(2!==s(t).length)throw new Error("open and close parts of brackets should be separated by space symbol");t=s(t).split("")}return t}))):e=Object.entries(e),t&&e.unshift(["'",,,!0],['"',,,!0]),this.bracketsMap=e.reduce(((e,[t,s,...r])=>{1!==r.length||this.searchWithin||r.unshift(void 0);let[i=this.searchWithin&&1,n]=r;return"number"==typeof i&&(i=[i]),e[t]={open:t,ignoreMode:n,searchLevels:i,close:s||t},e}),{}),this},createBracketsSearch(){const e=Object.entries(this.bracketsMap).flatMap((([,{close:e,open:t}])=>e!==t?[t,e]:t)).concat(Object.keys(this.mentions||{})).filter(Boolean),t=this.arrayToPattern(e);return this.bracketsSearch=this.createRegExp(t),this},createSeparatorsSearch(){const{separators:e}=this;if("string"==typeof e||Array.isArray(e)){const t=this.arrayToPattern([e].flat().filter(Boolean));this.separatorSearch=this.createRegExp(t)}else e?(this.separatorSearch=e,this.ignoreCase=e.ignoreCase):this.separatorSearch=/empty/;return this}}.init());r.screenedSymbols=void 0;const i=(e,t)=>{if(3===e.length){if(!t)return e}else if(1===e.length){const t=s(e);"string"==typeof t?e.push(",",{}):Array.isArray(t)?(e.unshift(null),e.push({})):"object"==typeof t&&e.unshift(null,",")}else if(2===e.length)"string"==typeof e[1]||Array.isArray(e[1])?e.push({}):e.unshift(null);else if(e.length>3)throw new Error("Too much arguments passed to splitSmartly function!!!");return t&&(e[2]={...e[2],...t}),e};function n(...e){let[t,s,n]=i(e);const a=r(s,n),h=o(a);return null!==t?h(t):h}function a(e,t){const s=this.merge(t);let r=new h(e,s);return"number"==typeof s.indexes?r.getNext():s.returnIterator?r:r.getAll()}n.searchWithin=(...e)=>(1===e.length&&("string"==typeof e[0]?e.push(null,{}):e.unshift(null)),"object"==typeof e[1]&&e[1].brackets||(e[1]={brackets:e[1]}),e.splice(1,0,null),n(...i(e,{searchWithin:!0}))),n.search=(...e)=>n(...i(e,{includeSeparatorMode:"ONLY"}));const o=e=>{const t=a.bind(e);return Object.assign(t,{getOne(e,s,r={}){if(isNaN(s))throw new Error("second parameter of `getOne` function should be index");return t(e,{...r,indexes:s})},getFirst:(e,s={})=>t(e,{...s,indexes:0}),getIndexes(e,s,r={}){if(!Array.isArray(s))throw new Error("second parameter of `getOne` function should be array of indexes");return t(e,{...r,indexes:s})},getIterator:(e,s={})=>t(e,{...s,returnIterator:!0})})};class h{constructor(e,t){this.string=e,this.searchSettings=t,this.prepareSearch()}prepareSearch(){const{separatorSearch:e,bracketsSearch:s,indexes:r}=this.searchSettings,i=[r].flat().filter(Boolean);for(const t of[e,s])t.lastIndex=0;Object.assign(this,{brackets:[],pipe:[],currentMentions:[],position:0,isDone:!1,freeArea:{start:0,end:void 0},lastSeparator:void 0,searchString:this.searchSettings.ignoreCase&&!this.searchSettings.separatorSearch.ignoreCase?this.string.toUpperCase():this.string,indexes:!t(i)&&{values:new Set(i),max:Math.max(...i),count:0,hasIndex(){return-Infinity===this.max||this.values.has(this.count++)},isOverMax(){return-Infinity!==this.max&&this.count>this.max}}})}get pipeIsEmpty(){return t(this.pipe)}getMentions(e,t){const s=[],r=[];for(const i of this.currentMentions)i.index>=e&&i.index<t?s.push(i.mention):r.push(i);return[s.length&&s,r]}trimResultText(e){return this.searchSettings.trimResult?e.trim():e}trimSeparatorText(e){return this.searchSettings.trimSeparators?e.trim():e}checkSeparator(t){const{string:s}=this,{check:r,includePositions:i,mentions:n}=this.searchSettings;let{0:a="",index:o=s.length,searchWithinData:h}=null!=t?t:{};const c=a.length,p=h?h.openPosition:this.position;let l=s.substring(p,o);a||(this.isDone=!0),l=this.trimResultText(l),a=this.trimSeparatorText(a);let u,g=h?[h.open,h.close]:a;if(i&&(l={text:l,position:p},g={text:g,position:o,isSeparator:!0}),n){l="string"==typeof l?{text:l}:l;const[e,t]=this.getMentions(p,o);e&&(l.mentions=e,u=t)}if(r&&a){const t=isNaN(this.tempPosition)?p:this.tempPosition;this.tempPosition=o+a.length;const i=this;if(!r({getString:e((()=>i.trimResultText(s.substring(t,o)))),getTextAfter:e((()=>s.substring(o+a.length))),getMentions:e((()=>i.getMentions(t,o)[0])),getSeparator:e((()=>a)),get string(){return this.getString()},get textAfter(){return this.getTextAfter()},get mentions(){return this.getMentions()},get separator(){return this.getSeparator()}}))return[];delete this.tempPosition}return u&&(this.currentMentions=u),this.position=o+c,[l,g,!0]}pushToPipe(e){if(this.indexes){if(!this.indexes.hasIndex())return;this.indexes.isOverMax()&&(this.isDone=!0)}this.pipe.push(e)}addToPipe(e){let[t,s,r]=this.checkSeparator(e);if(!r)return!1;switch(this.searchSettings.includeSeparatorMode){case"SEPARATELY":this.pushToPipe(t),s&&this.pushToPipe(s);break;case"LEFT":this.pushToPipe([t,s]);break;case"RIGHT":!("object"==typeof t?t.text:t)&&!this.lastSeparator||this.pushToPipe([this.lastSeparator,t]),this.lastSeparator=s;break;case"ONLY":s&&this.pushToPipe(s);break;default:this.pushToPipe(t)}return!this.pipeIsEmpty}findBrackets(){const{searchString:e,brackets:s,freeArea:r,searchSettings:i}=this,{bracketsSearch:n,separatorSearch:a,searchWithin:o}=i,h=o?()=>this.pipeIsEmpty:()=>!r.end;for(;h();){var c;const h=n.exec(e);if(!h){if(o||isNaN(r.start))return!1;r.end=e.length-1;continue}const l=h[0],{close:u,ignoreMode:g,searchLevels:d}=(p=s)[p.length-1]||{};let f;switch((l===u?1:g&&4)||(f=i.bracketsMap[l])&&2||(null==(c=i.mentions)?void 0:c[l])&&3){case 1:const e=s.pop();o?(!0===d||d.includes(s.length+1))&&this.addToPipe(Object.assign(h,{searchWithinData:e})):t(s)&&(r.start=h.index,a&&a.lastIndex<r.start&&(a.lastIndex=r.start));break;case 2:s.push({...f,openPosition:h.index+l.length}),1!==s.length||o||(r.end=h.index);break;case 3:this.currentMentions.push({mention:i.mentions[l],index:h.index})}}var p;return!0}findSeparator(e){const{searchString:t,freeArea:s}=this,{separatorSearch:r}=this.searchSettings;let i;for(;!i;){if(e=e||r.exec(t))if(e.index<=s.end){const t=e.index>=s.start&&this.addToPipe(e);if(e=null,!t)continue}else s.start=s.end=void 0;else this.addToPipe();i=!0}return e}getNext(){let e;for(;this.pipeIsEmpty&&!this.isDone;)this.findBrackets()?this.searchSettings.searchWithin||(e=this.findSeparator(e)):this.isDone=!0;return this.pipeIsEmpty?null:this.pipe.shift()}getAll(){return[...this]}getRest(){const e=[];let t;for(;null!==(t=this.getNext());)e.push(t);return e}*[Symbol.iterator](){this.prepareSearch();const e=this;let t;do{t=e.getNext(),null!==t&&(yield t)}while(null!==t)}}var c;exports.EnumIncludeSeparatorMode=void 0,(c=exports.EnumIncludeSeparatorMode||(exports.EnumIncludeSeparatorMode={})).INCLUDE_SEPARATOR_NONE="NONE",c.INCLUDE_SEPARATOR_SEPARATELY="SEPARATELY",c.INCLUDE_SEPARATOR_LEFT="LEFT",c.INCLUDE_SEPARATOR_RIGHT="RIGHT",c.INCLUDE_SEPARATOR_ONLY="ONLY",exports.INCLUDE_SEPARATOR_LEFT="LEFT",exports.INCLUDE_SEPARATOR_NONE="NONE",exports.INCLUDE_SEPARATOR_ONLY="ONLY",exports.INCLUDE_SEPARATOR_RIGHT="RIGHT",exports.INCLUDE_SEPARATOR_SEPARATELY="SEPARATELY",exports.SearchResults=h,exports.createSplitFunction=o,exports.default=n,exports.splitSmartly=n;
//# sourceMappingURL=split-smartly.cjs.production.min.js.map
