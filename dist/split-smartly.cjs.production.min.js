"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>{let t,r;return function(...s){return r||(t=e(...s),r=!0),t}},t=e=>{if(!e)return!0;if(Array.isArray(e)){if(0===e.length)return!0}else if("object"==typeof e&&0===Object.keys(e).length)return!0;return!1},r=e=>e[0],s=(e,t)=>{if(null==e||!e.length)throw new RangeError("empty arguments");if(3===e.length){if(!t)return e}else if(1===e.length){const t=r(e);"string"==typeof t?e.push(",",{}):Array.isArray(t)?(e.unshift(null),e.push({})):"object"==typeof t&&e.unshift(null,",")}else if(2===e.length)"string"==typeof e[0]&&e[1]instanceof RegExp||"string"==typeof e[1]||Array.isArray(e[1])?e.push({}):e.unshift(null);else if(e.length>3)throw new RangeError("Too much arguments passed to splitSmartly function!!!");return t&&(e[2]={...e[2],...t}),e};let n;const i=(e,s)=>({brackets:[],mentions:[],ignoreInsideQuotes:!0,includeSeparatorMode:"NONE",ignoreCase:!0,trimResult:!0,trimSeparators:!1,defaultBrackets:[["(",")"],["[","]"],["{","}"]],...s,separators:e,init(){return function(e){if(Array.isArray(e.mentions)||"string"==typeof e.mentions){const r=[e.mentions].flat().filter(Boolean).reduce(((t,r)=>(t[e.ignoreCase?r.toUpperCase():r]=r,t)),{});e.mentions=!t(r)&&r}return e.createBracketsMap().createBracketsSearch().createSeparatorsSearch()}(this)},merge(e){return function(e,t){return t?(t={...e,...t},["brackets","mentions"].some((e=>e in t))&&t.init(),t):e}(this,e)},arrayToPattern:e=>function(e){var t;return null!==(t=n)&&void 0!==t||(n=new Set(".{}[]^()+*?\\/$|".split(""))),e.map((e=>e instanceof RegExp?e.source:e.split("").map((e=>n.has(e)?"\\"+e:e)).join(""))).join("|")}(e),createRegExp:e=>RegExp(e,"g"),createBracketsMap(){return function(e){let t=e.brackets=function(e,t){var s;return!0===e?e=t.slice():"object"!=typeof e||Array.isArray(e)?"string"==typeof e&&(e=e.split(",").map((e=>{let t=e.trim().split(" ");if(2!==t.length){if(2!==r(t).length)throw new TypeError("open and close parts of brackets should be separated by space symbol");t=r(t).split("")}return t}))):e=Object.entries(e),null!==(s=e)&&void 0!==s?s:[]}(e.brackets,e.defaultBrackets);return t=function(e,t){return t.ignoreInsideQuotes&&e.unshift(["'",,,!0],['"',,,!0]),e}(t,e),e.bracketsMap=function(e,t){return e.reduce(((e,[r,s,...n])=>{1!==n.length||t||n.unshift(void 0);let[i=t&&1,a]=n;return"number"==typeof i&&(i=[i]),e[r]={open:r,ignoreMode:a,searchLevels:i,close:s||r},e}),{})}(t,e.searchWithin),e}(this)},createBracketsSearch(){return function(e){const t=Object.entries(e.bracketsMap).flatMap((([,{close:e,open:t}])=>e!==t?[t,e]:t)).concat(Object.keys(e.mentions||{})).filter(Boolean),r=e.arrayToPattern(t);return e.bracketsSearch=e.createRegExp(r),e}(this)},createSeparatorsSearch(){return function(e){const{separators:t}=e;if("string"==typeof t||Array.isArray(t)){const r=e.arrayToPattern([t].flat().filter(Boolean));e.separatorSearch=e.createRegExp(r)}else t?(e.separatorSearch=t,e.ignoreCase=t.ignoreCase):e.separatorSearch=/empty/;return e}(this)}}.init());function a(e){const r=[e].flat().filter(Boolean);return!t(r)&&{values:new Set(r),max:Math.max(...r),count:0,hasIndex(){return-Infinity===this.max||this.values.has(this.count++)},isOverMax(){return-Infinity!==this.max&&this.count>this.max}}}class o{constructor(e,t){this.string=e,this.searchSettings=t,this.prepareSearch()}prepareSearch(){for(const e of[this.searchSettings.separatorSearch,this.searchSettings.bracketsSearch])e.lastIndex=0;Object.assign(this,{brackets:[],pipe:[],currentMentions:[],position:0,isDone:!1,freeArea:{start:0,end:void 0},lastSeparator:void 0,searchString:this.searchSettings.ignoreCase&&!this.searchSettings.separatorSearch.ignoreCase?this.string.toUpperCase():this.string,indexes:a(this.searchSettings.indexes)})}get pipeIsEmpty(){return t(this.pipe)}getMentions(e,t){const r=[],s=[];for(const n of this.currentMentions)n.index>=e&&n.index<t?r.push(n.mention):s.push(n);return[r.length&&r,s]}trimResultText(e){return this.searchSettings.trimResult?e.trim():e}trimSeparatorText(e){return this.searchSettings.trimSeparators?e.trim():e}checkSeparator(t){const{string:r}=this,{check:s,includePositions:n,mentions:i}=this.searchSettings;let{0:a="",index:o=r.length,searchWithinData:h}=null!=t?t:{};const c=a.length,p=h?h.openPosition:this.position;let u=r.substring(p,o);a||(this.isDone=!0),u=this.trimResultText(u),a=this.trimSeparatorText(a);let l,g=h?[h.open,h.close]:a;if(n&&(u={text:u,position:p},g={text:g,position:o,isSeparator:!0}),i){u="string"==typeof u?{text:u}:u;const[e,t]=this.getMentions(p,o);e&&(u.mentions=e,l=t)}if(s&&a){const t=isNaN(this.tempPosition)?p:this.tempPosition;this.tempPosition=o+a.length;const n=this;if(!s({getString:e((()=>n.trimResultText(r.substring(t,o)))),getTextAfter:e((()=>r.substring(o+a.length))),getMentions:e((()=>n.getMentions(t,o)[0])),getSeparator:e((()=>a)),get string(){return this.getString()},get textAfter(){return this.getTextAfter()},get mentions(){return this.getMentions()},get separator(){return this.getSeparator()}}))return[];delete this.tempPosition}return l&&(this.currentMentions=l),this.position=o+c,[u,g,!0]}pushToPipe(e){if(this.indexes){if(!this.indexes.hasIndex())return;this.indexes.isOverMax()&&(this.isDone=!0)}this.pipe.push(e)}addToPipe(e){let[t,r,s]=this.checkSeparator(e);if(!s)return!1;switch(this.searchSettings.includeSeparatorMode){case"SEPARATELY":this.pushToPipe(t),r&&this.pushToPipe(r);break;case"LEFT":this.pushToPipe([t,r]);break;case"RIGHT":!("object"==typeof t?t.text:t)&&!this.lastSeparator||this.pushToPipe([this.lastSeparator,t]),this.lastSeparator=r;break;case"ONLY":r&&this.pushToPipe(r);break;default:this.pushToPipe(t)}return!this.pipeIsEmpty}findBrackets(){const{searchString:e,brackets:r,freeArea:s,searchSettings:n}=this,{bracketsSearch:i,separatorSearch:a,searchWithin:o}=n,h=o?()=>this.pipeIsEmpty:()=>("number"!=typeof s.start||s.start!==s.end)&&!s.end;for(;h();){var c;const h=i.exec(e);if(!h){if(o||isNaN(s.start))return!1;s.end=e.length-1;continue}const u=h[0],{close:l,ignoreMode:g,searchLevels:f}=(p=r)[p.length-1]||{};let d;switch((u===l?1:g&&4)||(d=n.bracketsMap[u])&&2||(null===(c=n.mentions)||void 0===c?void 0:c[u])&&3){case 1:const e=r.pop();o?(!0===f||f.includes(r.length+1))&&this.addToPipe(Object.assign(h,{searchWithinData:e})):t(r)&&(s.start=h.index,a&&a.lastIndex<s.start&&(a.lastIndex=s.start));break;case 2:r.push({...d,openPosition:h.index+u.length}),1!==r.length||o||(s.end=h.index);break;case 3:this.currentMentions.push({mention:n.mentions[u],index:h.index})}}var p;return!0}findSeparator(e){const{searchString:t,freeArea:r}=this,{separatorSearch:s}=this.searchSettings;let n;for(;!n;){if(e=e||s.exec(t))if(e.index<=r.end){const t=e.index>=r.start&&this.addToPipe(e);if(e=null,!t)continue}else r.start=r.end=void 0;else this.addToPipe();n=!0}return e}getNext(){let e;for(;this.pipeIsEmpty&&!this.isDone;)this.findBrackets()?this.searchSettings.searchWithin||(e=this.findSeparator(e)):this.isDone=!0;return this.pipeIsEmpty?null:this.pipe.shift()}getAll(){return[...this]}getRest(){const e=[];let t;for(;null!==(t=this.getNext());)e.push(t);return e}*[Symbol.iterator](){this.prepareSearch();const e=this;let t;do{t=e.getNext(),null!==t&&(yield t)}while(null!==t)}}function h(e,t){const r=this.merge(t);let s=new o(e,r);return"number"==typeof r.indexes?s.getNext():r.returnIterator?s:s.getAll()}const c=e=>{const t=h.bind(e);return Object.assign(t,{getOne(e,r,s={}){if(isNaN(r))throw new TypeError("second parameter of `getOne` function should be index");return t(e,{...s,indexes:r})},getFirst:(e,r={})=>t(e,{...r,indexes:0}),getIndexes(e,r,s={}){if(!Array.isArray(r))throw new TypeError("second parameter of `getOne` function should be array of indexes");return t(e,{...s,indexes:r})},getIterator:(e,r={})=>t(e,{...r,returnIterator:!0})})};var p,u;function l(...e){let[t,r,n]=s(e);const a=i(r,n),o=c(a);return null!==t?o(t):o}exports.EnumIncludeSeparatorMode=void 0,(p=exports.EnumIncludeSeparatorMode||(exports.EnumIncludeSeparatorMode={})).INCLUDE_SEPARATOR_NONE="NONE",p.INCLUDE_SEPARATOR_SEPARATELY="SEPARATELY",p.INCLUDE_SEPARATOR_LEFT="LEFT",p.INCLUDE_SEPARATOR_RIGHT="RIGHT",p.INCLUDE_SEPARATOR_ONLY="ONLY",function(e){e[e.ACTION_CLOSE=1]="ACTION_CLOSE",e[e.ACTION_OPEN=2]="ACTION_OPEN",e[e.ACTION_ADD_FRAGMENT=3]="ACTION_ADD_FRAGMENT",e[e.ACTION_NULL=4]="ACTION_NULL"}(u||(u={})),l.searchWithin=(...e)=>(1===e.length&&("string"==typeof e[0]?e.push(null,{}):e.unshift(null)),"object"==typeof e[1]&&e[1].brackets||(e[1]={brackets:e[1]}),e.splice(1,0,null),l(...s(e,{searchWithin:!0}))),l.search=(...e)=>l(...s(e,{includeSeparatorMode:"ONLY"})),exports.SearchResults=o,exports.createSplitFunction=c,exports.default=l,exports.splitSmartly=l;
//# sourceMappingURL=split-smartly.cjs.production.min.js.map
